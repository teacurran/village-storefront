# Village Storefront Application Configuration

# Application name
quarkus.application.name=village-storefront

# HTTP configuration
quarkus.http.port=8080

# Database configuration (PostgreSQL)
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=${DB_USER:storefront}
quarkus.datasource.password=${DB_PASSWORD:storefront}
quarkus.datasource.jdbc.url=${DB_URL:jdbc:postgresql://localhost:5432/storefront}

# Hibernate ORM
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.log.sql=false

# Quinoa (Vue.js admin dashboard) - configured when frontend is initialized
# See pom.xml to enable quarkus-quinoa dependency
# quarkus.quinoa.package-manager-install=true
# quarkus.quinoa.package-manager-command.install=npm ci
# quarkus.quinoa.package-manager-command.build=npm run build
# quarkus.quinoa.dev-server.port=5173
# quarkus.quinoa.ui-dir=src/main/webui

# OpenAPI
quarkus.smallrye-openapi.path=/openapi

# Health checks
quarkus.smallrye-health.ui.always-include=true

# Logging
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n
quarkus.log.level=INFO

# JWT configuration
mp.jwt.verify.issuer=https://village-storefront.example.com
mp.jwt.verify.publickey.location=publicKey.pem
smallrye.jwt.sign.key.location=privateKey.pem

# Metrics
quarkus.micrometer.export.prometheus.enabled=true

# OpenTelemetry
quarkus.otel.enabled=false
quarkus.otel.exporter.otlp.endpoint=http://localhost:4317

# Mailer (disabled in dev)
quarkus.mailer.mock=true

# Stripe Payment Provider Configuration
stripe.api.secret-key=${STRIPE_SECRET_KEY:sk_test_replace_with_your_key}
stripe.api.publishable-key=${STRIPE_PUBLISHABLE_KEY:pk_test_replace_with_your_key}
stripe.webhook.signing-secret=${STRIPE_WEBHOOK_SECRET:whsec_replace_with_your_secret}
stripe.webhook.skip-verification=${STRIPE_WEBHOOK_SKIP:false}
stripe.api.version=2023-10-16
stripe.connect.enabled=true
stripe.api.max-retries=3
stripe.api.timeout-ms=30000
stripe.test-mode=${STRIPE_TEST_MODE:true}

# Caffeine cache configuration for tenant resolution and feature flags
# Tenant cache: hostname -> TenantInfo
quarkus.cache.caffeine."tenant-cache".maximum-size=1000
quarkus.cache.caffeine."tenant-cache".expire-after-write=PT5M

# Feature flag cache: (tenant_id, flag_key) -> Boolean
quarkus.cache.caffeine."feature-flag-cache".maximum-size=5000
quarkus.cache.caffeine."feature-flag-cache".expire-after-write=PT1M

# Catalog search cache: (tenant_id, search_query_hash, page, size) -> List<Product>
quarkus.cache.caffeine."catalog-search-cache".maximum-size=1000
quarkus.cache.caffeine."catalog-search-cache".expire-after-write=PT5M

# Test profile configuration
%test.quarkus.datasource.db-kind=h2
%test.quarkus.datasource.jdbc.url=jdbc:h2:mem:test;MODE=PostgreSQL;DB_CLOSE_DELAY=-1
%test.quarkus.hibernate-orm.database.generation=drop-and-create
%test.quarkus.hibernate-orm.log.sql=true
%test.quarkus.http.port=0
%test.quarkus.http.test-port=0

# Disable JWT verification for tests (use @TestSecurity for auth testing)
%test.mp.jwt.verify.publickey.location=
%test.smallrye.jwt.sign.key.location=
%test.quarkus.smallrye-jwt.enabled=false
%test.stripe.webhook.signing-secret=whsec_test_secret
%test.stripe.webhook.skip-verification=true
